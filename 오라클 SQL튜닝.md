## SQL 튜닝

### 📌 SQL 프로시져

- SQL문장을 하나로 묶어 저장해 두는 '작은프로그램'
- 자주쓰는 쿼리나 반복작업 미리 저장해두고 필요할때마다 호출해서 실행하게 하는 기능

# Oracle 프로시저 개념 정리: 대량 데이터 생성 및 COMMIT 제어

## ✅ 프로시저 1: `DEV.GENERATE_ORD_BASE`

- **역할**: 임시 주문 테이블에 대량의 주문 데이터를 생성
- **입력 인자**:

  - `P_GEN_AMOUNT` : 생성할 주문 수량 (예: 15,000,000)
  - `P_COMMIT_NUMBER` : 몇 건마다 COMMIT 할지 지정 (예: 10,000)

- **예시 실행**:

  ```sql
  EXEC DEV.GENERATE_ORD_BASE(15000000, 10000);
  ```

- **설명**:
  - 총 15,000,000건의 주문 데이터를 생성
  - 10,000건마다 한 번씩 COMMIT 실행

## ✅ 프로시저 2: `DEV.INSERT_ORD_ITEM`

- **역할**: 주문 상세 항목(ORD_ITEM 테이블) 데이터를 삽입
- **입력 인자**: `P_GEN_AMOUNT`, `P_COMMIT_NUM` 사용 방식 동일

---

## 💡 왜 COMMIT 단위를 나눌까?

- 메모리 사용량 관리
- REDO 로그 과다 방지
- 트랜잭션 롤백 시 복구 부담 감소

---

## 📌 요약

| 항목              | 설명                                     |
| ----------------- | ---------------------------------------- |
| `P_GEN_AMOUNT`    | 총 생성할 데이터 건수                    |
| `P_COMMIT_NUMBER` | COMMIT을 몇 건마다 수행할지 설정         |
| 목적              | 대용량 데이터 생성 시 시스템 부하 최소화 |

# 📘 SQL 인덱스와 클러스터링 팩터 정리

## 📌 1. 인덱스(Index)란?

### ✅ 정의

- 테이블의 특정 컬럼에 대해 **검색 속도를 향상**시키기 위해 생성하는 객체
- 마치 책의 목차처럼, 원하는 데이터를 빠르게 찾도록 도와줌

### ✅ 인덱스를 사용하는 이유

- WHERE, JOIN, ORDER BY, GROUP BY 등의 연산을 **더 빠르게 수행**
- **대용량 테이블**에서 성능 향상 효과가 큼

### ✅ 인덱스 구조

- 일반적으로 **B\*-Tree 인덱스** 사용
- 정렬된 트리 구조로, 빠른 탐색 가능 (이진 탐색처럼 동작)

---

## 📌 2. 클러스터링 팩터(Clustering Factor)

### ✅ 정의

- **인덱스의 순서와 실제 테이블의 데이터 저장 순서가 얼마나 유사한지** 나타내는 값
- 쉽게 말해, 인덱스를 따라 테이블 데이터를 읽을 때 **연속적으로 읽히는지, 흩어져 있는지**를 보여줌

### ✅ 특징

- **낮은 값**: 인덱스 순서와 테이블 물리적 순서가 거의 일치 → I/O 효율 좋음
- **높은 값**: 순서가 어긋남 → 디스크 블록 접근이 많아져 I/O 비효율

### ✅ 예시 비교

| 상태        | 설명                                    | 클러스터링 팩터 |
| ----------- | --------------------------------------- | --------------- |
| 정렬 일치   | 인덱스 순서대로 테이블도 정렬됨         | 낮음 (수천)     |
| 정렬 불일치 | 인덱스 순서와 테이블 데이터 순서 불일치 | 높음 (수십만)   |

---

## 📌 성능 튜닝 팁

- **클러스터링 팩터가 낮은 인덱스를 사용하는 것이 성능에 유리**
- 클러스터링 팩터가 너무 높으면 오라클 옵티마이저가 `FULL TABLE SCAN`을 선택할 수 있음
- 낮추는 방법:
  - 테이블을 정렬된 상태로 재생성 (CTAS: Create Table As Select)
  - 또는 `Index Organized Table (IOT)` 고려

---

## 🔍 클러스터링 팩터 확인 SQL

```sql
SELECT index_name, clustering_factor
FROM user_indexes
WHERE table_name = 'YOUR_TABLE';
```
